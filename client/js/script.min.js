function mapInitialize(){map=new google.maps.Map(document.getElementById("map-canvas"),{zoom:12,center:new google.maps.LatLng(45.764043,4.835659)}),infowindow=new google.maps.InfoWindow({content:"Test"}),google.maps.event.addListener(map,"click",function(){infowindow.close(map)}),nycMarathonInitialize()}function nycMarathonInitialize(){var e=new google.maps.Polyline({path:nycMarathonCoordinates,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2});e.setMap(map)}function updateMarker(e,t,n){var a=users[e];a||(a=createUser(e),users[e]=a),a.marker.setPosition(new google.maps.LatLng(t,n))}function createUser(e){var t=new Object;t.name=e;var n=new google.maps.Marker({map:map});return google.maps.event.addListener(n,"click",function(){infowindow.setContent(n.getTitle()),infowindow.open(map,n)}),n.setIcon("lj"===e?"./img/tuile_lj.png":"./img/tuile_ml.png"),t.marker=n,t}function updateIndicator(e,t,n,a){"lj"===e?(countLJ++,window.tabHrLj.addData([t],""),window.tabSpeedLj.addData([n],""),updateChartData(window.tabDistLj,a),countLJ>10&&(window.tabHrLj.removeData(),window.tabSpeedLj.removeData()),window.tabHrLj.update(),window.tabSpeedLj.update(),null!=t&&(document.getElementById("hr_lj").textContent=t+" BPM"),null!=n&&(document.getElementById("speed_lj").textContent=n+" km/h"),null!=a&&(document.getElementById("distance_lj").textContent=a+" métres")):(countML++,window.tabHrMl.addData([t],""),window.tabSpeedMl.addData([n],""),updateChartData(window.tabDistMl,a),countML>10&&(window.tabHrMl.removeData(),window.tabSpeedMl.removeData()),window.tabSpeedMl.update(),window.tabHrMl.update(),null!=t&&(document.getElementById("hr_ml").textContent=t+" BPM"),null!=n&&(document.getElementById("speed_ml").textContent=n+" km/h"),null!=a&&(document.getElementById("distance_ml").textContent=a+" métres"))}function addDataKm(e,t,n,a){var o=document.createElement("tr");o.innerHTML='  <th scope="row">'+e+"</th> <td>"+a.h+":"+a.m+":"+a.s+"</td>  <td>"+n.h+":"+n.m+":"+n.s+"</td>   ","lj"===t?document.getElementById("table_km_lj").appendChild(o):document.getElementById("table_km_ml").appendChild(o)}function updateChartData(e,t){e.removeData(),e.removeData();var n,a;t>500?(a=Math.round(t/42195*100),n=100-a):(n=100,a=0),e.addData({value:n,color:"#f35146",highlight:"#f35146",label:"A faire en %"}),e.addData({value:a,color:"#cbeb2e",highlight:"#cbeb2e",label:"Fait en %"}),e.update()}!function(e,t,n,a,o,l,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,l=t.createElement(n),i=t.getElementsByTagName(n)[0],l.async=1,l.src=a,i.parentNode.insertBefore(l,i)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-57925881-11","auto"),ga("send","pageview");var map=null,countLJ=null,countML=null,clock_ml=null,clock_lj=null,users={},data={labels:[],datasets:[{fillColor:"#0b0f1a",strokeColor:"rgba(172, 12, 14, 0.9)",pointColor:"rgba(172, 12, 14, 0.9)",pointStrokeColor:"rgba(249, 12, 14, 0.9)",pointHighlightFill:"rgba(249, 12, 14, 0.9)",pointHighlightStroke:"rgba(249, 12, 14, 0.9)",data:[]}]},socket=io.connect("/");socket.on("add_marker",function(e){updateMarker(e.user,e.lat,e["long"]),updateIndicator(e.user,e.hr,e.speed,e.distance)}),socket.on("add_data_table",function(e){addDataKm(e.nbk,e.user,e.time,e.tklk,e.speedlk,e.hrlk)}),socket.on("init_data_table_lj",function(e){for(var t=document.getElementById("table_km_lj");t.childNodes.length>2;)t.removeChild(t.lastChild);for(index=1;index<e.length;++index)null!=e[index]&&addDataKm(index,"lj",e[index][0],e[index][1],e[index][2],e[index][3])}),socket.on("init_data_table_ml",function(e){for(var t=document.getElementById("table_km_ml");t.childNodes.length>2;)t.removeChild(t.lastChild);for(index=1;index<e.length;++index)null!=e[index]&&addDataKm(index,"ml",e[index][0],e[index][1],e[index][2],e[index][3])}),socket.on("init_value",function(e){updateChartData(window.tabDistMl,e.distanceML),updateChartData(window.tabDistLj,e.distanceLJ)}),socket.on("init_clock_lj",function(e){clock_lj.setTime(e.timer),e.finish||clock_lj.start()}),socket.on("init_clock_ml",function(e){clock_ml.setTime(e.timer),e.finish||clock_ml.start()}),socket.on("start_clock_lj",function(){clock_lj.start()}),socket.on("start_clock_ml",function(){clock_ml.start()}),socket.on("stop_clock_lj",function(){clock_lj.stop()}),socket.on("stop_clock_ml",function(){clock_ml.stop()}),socket.on("start_message",function(e){document.getElementById("message").textContent=e.message}),socket.on("stop_message",function(){document.getElementById("message").textContent=""}),google.maps.event.addDomListener(window,"load",mapInitialize),window.onload=function(){var e=document.getElementById("tab_hr_ml").getContext("2d");window.tabHrMl=new Chart(e).Line(data,{scaleShowGridLines:!0,responsive:!0,bezierCurve:!0,scaleLineColor:"rgba(255, 255, 255, 1)",showScale:!0,scaleOverride:!0,scaleSteps:7,scaleStepWidth:20,scaleStartValue:60});var e=document.getElementById("tab_speed_ml").getContext("2d");window.tabSpeedMl=new Chart(e).Line(data,{scaleShowGridLines:!0,responsive:!0,bezierCurve:!0,scaleLineColor:"rgba(255, 255, 255, 1)",showScale:!0,scaleOverride:!0,scaleSteps:9,scaleStepWidth:2,scaleStartValue:0});var e=document.getElementById("tab_dist_ml").getContext("2d");window.tabDistMl=new Chart(e).Doughnut(null,{responsive:!0,animationSteps:1,animateScale:!1});var e=document.getElementById("tab_hr_lj").getContext("2d");window.tabHrLj=new Chart(e).Line(data,{responsive:!0,bezierCurve:!0,scaleLineColor:"rgba(255, 255, 255, 1)",showScale:!0,scaleOverride:!0,scaleSteps:7,scaleStepWidth:20,scaleStartValue:60});var e=document.getElementById("tab_speed_lj").getContext("2d");window.tabSpeedLj=new Chart(e).Line(data,{responsive:!0,bezierCurve:!0,scaleLineColor:"rgba(255, 255, 255, 1)",showScale:!0,scaleOverride:!0,scaleSteps:9,scaleStepWidth:2,scaleStartValue:0});var e=document.getElementById("tab_dist_lj").getContext("2d");window.tabDistLj=new Chart(e).Doughnut(null,{responsive:!0,animationSteps:1,animateScale:!1}),clock_ml=$(".marathon_clock_ml").FlipClock({autoStart:!1}),clock_lj=$(".marathon_clock_lj").FlipClock({autoStart:!1})};
