<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>Smoozi NYC</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="Description" lang="en" content="ADD SITE DESCRIPTION">
		<meta name="author" content="ADD AUTHOR INFORMATION">
		<meta name="robots" content="index, follow">


		<!-- Override CSS file - add your own CSS rules -->
		<link rel="stylesheet" href="css/style.css">

    <!-- Import javascript -->
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBmhelMVEXev83EyFPJhCJ1fYnQleKPfos&sensor=true"></script>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="./js/marathon_value.js"></script>
    <script type="text/javascript" src="./js/chart.js"></script>

	</head>
	<body>

    <script>
    function mapInitialize() {
        map = new google.maps.Map(document.getElementById("map-canvas"), {
            zoom: 12,
            // nyc   center: new google.maps.LatLng(40.742494, -73.953867)
            center: new google.maps.LatLng(45.764043, 4.835659)
        });
        infowindow = new google.maps.InfoWindow({ content: 'Test' });
        google.maps.event.addListener(map, 'click', function() {
            infowindow.close(map);
        });

        nycMarathonInitialize();
    }


    function nycMarathonInitialize(){
        var nycMarathon = new google.maps.Polyline({
        path: nycMarathonCoordinates,
        geodesic: true,
        strokeColor: '#FF0000',
        strokeOpacity: 1.0,
        strokeWeight: 2
      });

        nycMarathon.setMap(map);
    }


    function updateMarker(name,lat,long){

      // Take the user
      var user = users[name];

    // si il n'esite pas on cr√©ait le marker et son user
              if(!user){
                user = createUser(name);
                users[name] = user;
              }

        //On update le marker ( qu(il soit nouveau ou ancien))
        user.marker.setPosition(new google.maps.LatLng(lat, long));

    }

    function createUser(name){

       var user = new Object();

      //affect the name
       user.name = name;

        // crearte the marker
        var marker = new google.maps.Marker({ map:map });
         google.maps.event.addListener(marker, 'click', function() {
                     infowindow.setContent(marker.getTitle());
                     infowindow.open(map, marker);
         });

         // Img management
         if(name === 'lj'){
           marker.setIcon('./img/LJ.png')
         }else{
           marker.setIcon('./img/ML.png')
         }

         // affect set marker
         user.marker = marker;

         return user;
    }



      function updateIndicator(name,hr,speed,distance){
        if(name === 'lj'){
        document.getElementById("lj_hr").textContent = hr;
        document.getElementById("lj_speed").textContent = speed;
        document.getElementById("lj_distance").textContent = distance;

        window.tabHrLj.addData([hr], "");
        window.tabSpeedLj.addData([speed], "");
        window.tabDistLj.addData([distance], "");

        window.tabHrLj.update();
        window.tabSpeedLj.update();
        window.tabDistLj.update();

      }else{
        document.getElementById("ml_hr").textContent = hr;
        document.getElementById("ml_speed").textContent = speed;
        document.getElementById("ml_distance").textContent = distance;

        window.tabHrMl.addData([hr], "");
        window.tabSpeedMl.addData([speed], "");
        window.tabDistMl.addData([distance], "");

        window.tabSpeedMl.update();
        window.tabHrMl.update();
        window.tabDistMl.update();
      }


    }


    ////////////////////////////////////////////////////////////////////
    ////////////// /GMAPS ///////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////

    ////////////////////////////////////////////////////////////////////
    ////////////// /Graph ///////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////
    var data_graph_tkil = {
        labels: [
                ],
        datasets: [
            {
                label: "Jalabert",
                fillColor: "rgba(220,220,220,0.5)",
                strokeColor: "rgba(220,220,220,0.8)",
                highlightFill: "rgba(220,220,220,0.75)",
                highlightStroke: "rgba(220,220,220,1)",
                data: [4.3,4.2]
            },
            {
                label: "Landreau",
                fillColor: "rgba(151,187,205,0.5)",
                strokeColor: "rgba(151,187,205,0.8)",
                highlightFill: "rgba(151,187,205,0.75)",
                highlightStroke: "rgba(151,187,205,1)",
                data: [5.1,4.1]
            }
        ]
    };

    var data = {
        labels: [
                ],
        datasets: [
            {
                fillColor: "rgba(220,220,220,0.5)",
                strokeColor: "rgba(220,220,220,0.8)",
                highlightFill: "rgba(220,220,220,0.75)",
                highlightStroke: "rgba(220,220,220,1)",
                data: []
            },
        ]
    };

    function updateGraph(name,tk){
      window.myBar.addData([tk, tk], "1k");
      window.myBar.update();
    }

    ////////////////////////////////////////////////////////////////////
    ////////////// /Graph ///////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////


    ////////////////////////////////////////////////////////////////////
    ////////////// Socket///////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////
    var socket = io.connect('/');

    socket.on('add_marker', function(data) {
        updateMarker(data.user,data.lat,data.long);
        updateIndicator(data.user,data.hr,data.speed,data.distance);
    })

    socket.on('add_pk', function(data) {
        updateGraph(data.user,data.tk);
    })

    socket.on('init_pk', function(data) {
      for (index = 0; index < data.tks.length; ++index) {
        window.myBar.addData([data.tks[index][1],data.tks[index][2]], data.tks[index][0]);
      }
    })
    ////////////////////////////////////////////////////////////////////
    ////////////// /Socket///////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////

    ////////////////////////////////////////////////////////////////////
    ////////////// Common ///////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////
    google.maps.event.addDomListener(window, 'load', mapInitialize);

    window.onload = function(){
      var ctx = document.getElementById("tab_hr_ml").getContext("2d");
      window.tabHrMl = new Chart(ctx).Line(data, {
         responsive : true,
         bezierCurve: true
      });

      var ctx = document.getElementById("tab_speed_ml").getContext("2d");
      window.tabSpeedMl = new Chart(ctx).Line(data, {
         responsive : true,
         bezierCurve: true
      });

      var ctx = document.getElementById("tab_dist_ml").getContext("2d");
      window.tabDistMl = new Chart(ctx).Line(data, {
         responsive : true,
         bezierCurve: true
      });


      var ctx = document.getElementById("tab_hr_lj").getContext("2d");
      window.tabHrLj = new Chart(ctx).Line(data, {
         responsive : true,
         bezierCurve: true
      });

      var ctx = document.getElementById("tab_speed_lj").getContext("2d");
      window.tabSpeedLj = new Chart(ctx).Line(data, {
         responsive : true,
         bezierCurve: true
      });

      var ctx = document.getElementById("tab_dist_lj").getContext("2d");
      window.tabDistLj = new Chart(ctx).Line(data, {
         responsive : true,
         bezierCurve: true
      });


    }

    </script>

		<div class="header">
			<div class="container">
				<h1 class="header-heading">Smoozi</h1>
			</div>
		</div>
		<div class="nav-bar">
			<div class="container">
				<ul class="nav">

				</ul>
			</div>
		</div>
		<div class="content">
			<div class="container">
				<div class="col1">

					<!-- Responsive images -->
					<p><img class="img-responsive" src="http://placehold.it/800x350" alt=""></p>


					<!-- Tables -->
					<h3>Tables</h3>
					<p>Tables should be given the class of <code>table</code>.</p>
					<table class="table table-striped">
						<thead>
							<tr>
								<th>#</th>
								<th>First Name</th>
								<th>Last Name</th>
								<th>Username</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<th scope="row">1</th>
								<td>Mark</td>
								<td>Otto</td>
								<td>@mdo</td>
							</tr>
							<tr>
								<th scope="row">2</th>
								<td>Jacob</td>
								<td>Thornton</td>
								<td>@fat</td>
							</tr>
							<tr>
								<th scope="row">3</th>
								<td>Larry</td>
								<td>the Bird</td>
								<td>@twitter</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="col2">
					<h3>Landreau</h3>
				</div>
				<div class="col3">
					<h3>Jalabert</h3>
				</div>
			</div>
		</div>
		<div class="footer">
			<div class="container">
				&copy; Copyright 2015 - Smoozy
			</div>
		</div>
	</body>
</html>
