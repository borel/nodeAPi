<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Smoozi NYC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="Description" lang="en" content="ADD SITE DESCRIPTION">
  <meta name="author" content="ADD AUTHOR INFORMATION">
  <meta name="robots" content="index, follow">


  <!-- Override CSS file - add your own CSS rules -->

  <link rel="stylesheet" type="text/css" href="./css/style.css" />
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBmhelMVEXev83EyFPJhCJ1fYnQleKPfos&sensor=true"></script>
  <script type="text/javascript" src="/socket.io/socket.io.js"></script>
  <script type="text/javascript" src="./js/marathon_value.js"></script>
  <script type="text/javascript" src="./js/chart.js"></script>



</head>
<body>


  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57925881-11', 'auto');
  ga('send', 'pageview');

  </script>

  <script type="text/javascript">
  ////////////////////////////////////////////////////////////////////
  ////////////// GMAPS ///////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////
  var map = null;
  var countLJ = null;
  var countML = null;

  // tab of user information
  var users = {};

  function mapInitialize() {
    map = new google.maps.Map(document.getElementById("map-canvas"), {
      zoom: 12,
      // nyc   center: new google.maps.LatLng(40.742494, -73.953867)
      center: new google.maps.LatLng(45.764043, 4.835659)
    });
    infowindow = new google.maps.InfoWindow({ content: 'Test' });
    google.maps.event.addListener(map, 'click', function() {
      infowindow.close(map);
    });

    nycMarathonInitialize();
  }


  function nycMarathonInitialize(){
    var nycMarathon = new google.maps.Polyline({
      path: nycMarathonCoordinates,
      geodesic: true,
      strokeColor: '#FF0000',
      strokeOpacity: 1.0,
      strokeWeight: 2
    });

    nycMarathon.setMap(map);
  }


  function updateMarker(name,lat,long){
    // Take the user
    var user = users[name];
    // si il n'esite pas on crÃ©ait le marker et son user
    if(!user){
      user = createUser(name);
      users[name] = user;
    }
    //On update le marker ( qu(il soit nouveau ou ancien))
    user.marker.setPosition(new google.maps.LatLng(lat, long));
  }

  function createUser(name){
    var user = new Object();

    //affect the name
    user.name = name;

    // crearte the marker
    var marker = new google.maps.Marker({ map:map });
    google.maps.event.addListener(marker, 'click', function() {
      infowindow.setContent(marker.getTitle());
      infowindow.open(map, marker);
    });

    // Img management
    if(name === 'lj'){
      //marker.setIcon('./img/LJ.png')
    }else{
      //marker.setIcon('./img/ML.png')
    }

    // affect set marker
    user.marker = marker;

    return user;
  }



  function updateIndicator(name,hr,speed,distance){

    if(name === 'lj'){

      // incrmeent the display token
      countLJ++;

      // document.getElementById("lj_hr").textContent = hr;
      // document.getElementById("lj_speed").textContent = speed;
      // document.getElementById("lj_distance").textContent = distance;
      //
      window.tabHrLj.addData([hr], "");
      window.tabSpeedLj.addData([speed], "");
      window.tabDistLj.addData([distance], "");

      // if there is already 10 value , we delete the first value
      if(countLJ > 10){
        window.tabHrLj.removeData();
        window.tabSpeedLj.removeData();
        window.tabDistLj.removeData();
      }
      //
      window.tabHrLj.update();
      window.tabSpeedLj.update();
      window.tabDistLj.update();

    }else{
      // incrmeent the display token
      countML++;

      // document.getElementById("ml_hr").textContent = hr;
      // document.getElementById("ml_speed").textContent = speed;
      // document.getElementById("ml_distance").textContent = distance;
      //
      window.tabHrMl.addData([hr], "");
      window.tabSpeedMl.addData([speed], "");
      window.tabDistMl.addData([distance], "");

      // if there is already 10 value , we delete the first value
      if(countML > 10){
        window.tabHrMl.removeData();
        window.tabSpeedMl.removeData();
        window.tabDistMl.removeData();
      }
      //
      window.tabSpeedMl.update();
      window.tabHrMl.update();
      window.tabDistMl.update();
    }


  }


  ////////////////////////////////////////////////////////////////////
  ////////////// /GMAPS ///////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////

  ////////////////////////////////////////////////////////////////////
  ////////////// /Graph ///////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////
  var data = {
    labels: [
    ],
    datasets: [
      {
        fillColor: "rgba(220,220,220,1",
        strokeColor: "rgba((32, 30, 33, 0.7)",
        highlightFill: "rgba(220,220,220,0.75)",
        highlightStroke: "rgba(220,220,220,1)",
        data: []
      },
    ]
  };

  ////////////////////////////////////////////////////////////////////
  ////////////// /Graph ///////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////


  ////////////////////////////////////////////////////////////////////
  ////////////// Socket///////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////
  var socket = io.connect('/');

  socket.on('add_marker', function(data) {
    updateMarker(data.user,data.lat,data.long);
    updateIndicator(data.user,data.hr,data.speed,data.distance);
  })

  socket.on('add_pk', function(data) {
    updateGraph(data.user,data.tk);
  })

  socket.on('init_pk', function(data) {
    for (index = 0; index < data.tks.length; ++index) {
      window.myBar.addData([data.tks[index][1],data.tks[index][2]], data.tks[index][0]);
    }
  })
  ////////////////////////////////////////////////////////////////////
  ////////////// /Socket///////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////

  ////////////////////////////////////////////////////////////////////
  ////////////// Common ///////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////
  google.maps.event.addDomListener(window, 'load', mapInitialize);

  window.onload = function(){
    var ctx = document.getElementById("tab_hr_ml").getContext("2d");
    window.tabHrMl = new Chart(ctx).Line(data, {
      responsive : true,
      bezierCurve: true,
      scaleLineColor: "rgba(204, 44, 44, 0.9)",
    });

    var ctx = document.getElementById("tab_speed_ml").getContext("2d");
    window.tabSpeedMl = new Chart(ctx).Line(data, {
      responsive : true,
      bezierCurve: true,
      scaleLineColor: "rgba(204, 44, 44, 0.9)",
    });

    var ctx = document.getElementById("tab_dist_ml").getContext("2d");
    window.tabDistMl = new Chart(ctx).Line(data, {
      responsive : true,
      bezierCurve: true,
      scaleLineColor: "rgba(204, 44, 44, 0.9)",
    });


    var ctx = document.getElementById("tab_hr_lj").getContext("2d");
    window.tabHrLj = new Chart(ctx).Line(data, {
      responsive : true,
      bezierCurve: true,
      scaleLineColor: "rgba(204, 44, 44, 0.9)",
    });

    var ctx = document.getElementById("tab_speed_lj").getContext("2d");
    window.tabSpeedLj = new Chart(ctx).Line(data, {
      responsive : true,
      bezierCurve: true,
      scaleLineColor: "rgba(204, 44, 44, 0.9)",
    });

    var ctx = document.getElementById("tab_dist_lj").getContext("2d");
    window.tabDistLj = new Chart(ctx).Line(data, {
      responsive : true,
      bezierCurve: true,
      scaleLineColor: "rgba(204, 44, 44, 0.9)",
    });


  }

  ////////////////////////////////////////////////////////////////////
  ////////////// /Common///////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////
  </script>


  <div class="header">
    <div class="container">
      <h1 class="header-heading">Smoozi</h1>
    </div>
  </div>
  <div class="nav-bar">
    <div class="container">
      <ul class="nav">

      </ul>
    </div>
  </div>
  <div class="content">
    <div class="container">
      <div class="col1">

        <!-- Responsive images -->
        <p><div id="map-canvas"></div></p>

        <p><div id="tc_810"><a title="NYC Marathon" href="http://www.tickcounter.com/countup/20151015120000am/w422/NYC_Marathon">NYC Marathon</a> <a title="Countup online" href="http://www.tickcounter.com">Countup</a></div><script type="text/javascript">(function(){var s = document.createElement("script");s.src = "http://www.tickcounter.com/widget/countup/20151015120000am/w422/810/0/000000fffcff757a85/NYC_Marathon";s.async = "async";s.type = "text/javascript";var x = document.getElementById("tc_810");x.insertBefore(s,x.lastChild);}());</script></p>

        <p><a style=" margin-left: auto; margin-right: auto;}" class="twitter-timeline" href="https://twitter.com/wurstcraftsman" data-widget-id="654673309544480768">Tweets by @wurstcraftsman</a></p>

        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>


      </div>
      <div class="col2">
        <h3>Landreau</h3>
        <p><canvas id="tab_hr_ml"></p>
          <p><canvas id="tab_dist_ml"></p>
            <p><canvas id="tab_speed_ml"></p>
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Km</th>
                    <th>Chrono</th>
                    <th>Temps pour réaliser le km</th>
                    <th>Vitesse moy</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row">2</th>
                    <td>5'12</td>
                    <td>5'12</td>
                    <td>12.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>4'32</td>
                    <td>4'32</td>
                    <td>15.5</td>
                  </tr>
                </tbody>
              </table>
      </div>

      <div class="col3">
              <h3>Jalabert</h3>
              <p><canvas id="tab_hr_lj"></p>
                <p><canvas id="tab_dist_lj"></p>
                  <p><canvas id="tab_speed_lj"></p>
                    <table class="table table-striped">
                      <thead>
                        <tr>
                          <th>Km</th>
                          <th>Chrono</th>
                          <th>Temps pour réaliser le km</th>
                          <th>Vitesse moy</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <th scope="row">2</th>
                          <td>5'12</td>
                          <td>5'12</td>
                          <td>12.5</td>

                        </tr>
                        <tr>
                          <th scope="row">3</th>
                          <td>4'32</td>
                          <td>4'32</td>
                          <td>15.5</td>

                        </tr>
                      </tbody>
                    </table>
      </div>
                </div>
              </div>


              <div class="footer">
                <div class="container">
                  &copy; Copyright 2015 - Smoozy
                </div>
              </div>
            </body>
            </html>
